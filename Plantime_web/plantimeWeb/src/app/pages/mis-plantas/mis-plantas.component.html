<div class="container">
  <div style="display:flex; gap:.5rem; justify-content:flex-end; margin-bottom:1rem;">
    <a class="btn btn-secondary" routerLink="/panel-control/calendario">Calendario</a>
    <a class="btn btn-secondary" routerLink="/mis-plantas/estadisticas">Estadísticas</a>
    <a class="btn btn-primary" routerLink="/crear-planta">Crear Planta</a>
  </div>

  <section class="grid" style="grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));">
    <div class="card" *ngFor="let planta of plantas">
      <div style="display:flex; align-items:center; gap:.5rem;">
        <div style="font-size:1.6rem;">{{ planta.icono }}</div>
        <div>
          <h3>{{ planta.nombre }}</h3>
          <div class="muted">Sensor: {{ planta.sensor }}</div>
        </div>
      </div>
      <div style="display:flex; gap:.5rem; flex-wrap:wrap; margin-top:.75rem;">
        <button class="btn btn-secondary" type="button" (click)="abrirAlarma(planta.nombre)">Alarma</button>
        <button class="btn btn-secondary" type="button" (click)="abrirNotas(planta.nombre)">Checklist</button>
        <button class="btn btn-secondary" type="button">Configuración</button>
        <button class="btn" [ngClass]="{'btn-toggle-on': toggles[planta.nombre].temperatura, 'btn-toggle-off': !toggles[planta.nombre].temperatura}" (click)="toggle(planta.nombre, 'temperatura')">Temperatura</button>
        <button class="btn" [ngClass]="{'btn-toggle-on': toggles[planta.nombre].humedad, 'btn-toggle-off': !toggles[planta.nombre].humedad}" (click)="toggle(planta.nombre, 'humedad')">Humedad</button>
        <button class="btn" [ngClass]="{'btn-toggle-on': toggles[planta.nombre].luz, 'btn-toggle-off': !toggles[planta.nombre].luz}" (click)="toggle(planta.nombre, 'luz')">Luz</button>
      </div>
    </div>
  </section>

  <!-- Modal de notas -->
  <div class="modal-backdrop" *ngIf="showNotasModal" (click)="cerrarNotas()"></div>
  <div class="modal" *ngIf="showNotasModal">
    <div class="modal-card">
      <h3>Notas de {{ showNotasModal }}</h3>
      <ul>
        <li *ngFor="let nota of notas[showNotasModal]; let i = index">
          {{ nota }} <button (click)="eliminarNota(showNotasModal, i)" style="color:red;background:none;border:none;cursor:pointer;">Eliminar</button>
        </li>
      </ul>
      <input [(ngModel)]="nuevaNota" placeholder="Agregar nota..." style="width:100%;padding:.5rem;margin-top:.5rem;" />
      <div style="display:flex; gap:.5rem; justify-content:flex-end; margin-top: .75rem;">
        <button class="btn btn-primary" (click)="agregarNota(showNotasModal)">Agregar</button>
        <button class="btn btn-secondary" (click)="cerrarNotas()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal de alarma -->
  <div class="modal-backdrop" *ngIf="showAlarmaModal" (click)="cerrarAlarma()"></div>
  <div class="modal" *ngIf="showAlarmaModal">
    <div class="modal-card">
      <h3>Asignar alarma a {{ showAlarmaModal }}</h3>
      <ul *ngIf="alarmas[showAlarmaModal]?.length">
        <li *ngFor="let alarma of alarmas[showAlarmaModal]; let i = index">
          {{ alarma.fecha }} {{ alarma.hora }} - {{ alarma.descripcion }}
          <button (click)="alarmas[showAlarmaModal].splice(i, 1)" style="color:red;background:none;border:none;cursor:pointer;">Eliminar</button>
        </li>
      </ul>
      <label style="display:block;margin-top:.5rem">Fecha</label>
      <input type="date" [(ngModel)]="alarmaFecha" style="width:100%;padding:.6rem;border:1px solid #eee;border-radius:8px;" />
      <label style="display:block;margin-top:.5rem">Hora</label>
      <input type="time" [(ngModel)]="alarmaHora" style="width:100%;padding:.6rem;border:1px solid #eee;border-radius:8px;" />
      <label style="display:block;margin-top:.5rem">Descripción</label>
      <input [(ngModel)]="alarmaDescripcion" placeholder="Ej: Revisar riego" style="width:100%;padding:.6rem;border:1px solid #eee;border-radius:8px;" />
      <div style="display:flex; gap:.5rem; justify-content:flex-end; margin-top: .75rem;">
        <button class="btn btn-primary" (click)="guardarAlarma(showAlarmaModal)">Guardar</button>
        <button class="btn btn-secondary" (click)="cerrarAlarma()">Cerrar</button>
      </div>
    </div>
  </div></div>
